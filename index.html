<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="唐诗三百首策略游戏 - 通过有趣的游戏方式学习中国古典诗词">
    <meta name="keywords" content="唐诗三百首,唐诗游戏,诗词学习,古诗游戏,中国古典文学">
    <title>唐诗三百首历史策略游戏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'KaiTi', 'SimSun', serif;
            background-color: #F7E9D9;
            color: #8B4513;
            text-align: center;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #8B4513;
            color: #F7E9D9;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin: 0;
        }

        .subtitle {
            font-size: 1.2rem;
            margin-top: 10px;
            font-weight: normal;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .language-switcher select {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #A0522D;
            background-color: #F7E9D9;
            color: #8B4513;
        }

        .intro {
            margin: 30px auto;
            max-width: 800px;
            background-color: #FFF;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.2);
        }

        .game-container {
            margin: 20px auto;
            background-color: #FFF;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.2);
        }

        .question {
            margin: 20px;
            font-size: 1.1rem;
        }

        .option {
            margin: 10px;
            padding: 12px 24px;
            background-color: #8B4513;
            color: #F7E9D9;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .option:hover {
            background-color: #A0522D;
            transform: translateY(-2px);
        }

        .svg-container {
            margin: 20px auto;
            max-width: 600px;
        }

        .read-button, .next-button, .restart-button {
            margin: 10px;
            padding: 12px 24px;
            background-color: #8B4513;
            color: #F7E9D9;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .start-button {
            margin: 20px auto;
            padding: 15px 30px;
            background-color: #A0522D;
            color: #F7E9D9;
            border: 2px solid #8B4513;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: inline-block;
        }

        .start-button:hover {
            background-color: #8B4513;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .start-button i {
            margin-right: 8px;
        }

        .read-button i, .next-button i, .restart-button i {
            margin-right: 5px;
        }

        .read-button:hover, .next-button:hover, .restart-button:hover {
            background-color: #A0522D;
            transform: translateY(-2px);
        }

        .poem-info {
            font-style: italic;
            margin: 10px 0;
            color: #A0522D;
        }

        footer {
            background-color: #8B4513;
            color: #F7E9D9;
            padding: 20px 0;
            margin-top: 40px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .social-links a {
            color: #F7E9D9;
            margin: 0 10px;
            font-size: 1.5rem;
            transition: color 0.3s;
        }

        .social-links a:hover {
            color: #D2B48C;
        }

        .copyright {
            margin-top: 10px;
        }

        .author-info {
            margin-top: 10px;
            color: #F7E9D9;
            font-size: 0.9rem;
        }
        
        .author-info a {
            color: #F7E9D9;
            text-decoration: underline;
        }
        
        .author-info a:hover {
            color: #D2B48C;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .option, .read-button, .next-button, .restart-button {
                padding: 10px 20px;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .social-links {
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="language-switcher">
            <select id="languageSelect">
                <option value="zh">中文</option>
                <option value="en">English</option>
            </select>
        </div>
        <div class="container">
            <h1>唐诗三百首历史策略游戏</h1>
            <p class="subtitle">探索古代诗词，体验历史变迁</p>
        </div>
    </header>

    <main class="container">
        <div class="intro">
            <h2>欢迎来到唐诗世界</h2>
            <p>在这个游戏中，您将通过做出不同的历史选择，探索中国古典诗词的魅力。每一个选择都将引领您走向不同的历史道路，解锁不同的诗词。请开始您的诗词之旅吧！</p>
        </div>

        <div class="game-container">
            <button id="start-button" class="start-button" onclick="startGame()">
                <i class="fas fa-play"></i> 开始您的旅程
            </button>
            <div id="question-container" class="question" style="display: none;"></div>
            <div id="result-container" style="display: none;">
                <p id="result-text"></p>
                <div class="poem-info">
                    <span id="poem-title"></span> - <span id="poem-author"></span>
                </div>
                <button class="read-button" onclick="readPoem()">
                    <i class="fas fa-volume-up"></i> 朗读诗词
                </button>
                <button class="next-button" onclick="showNextQuestion()">
                    <i class="fas fa-arrow-right"></i> 下一题
                </button>
                <button class="restart-button" onclick="restartGame()">
                    <i class="fas fa-redo"></i> 重新开始
                </button>
            </div>
            <div class="svg-container" id="poem-container"></div>
        </div>
    </main>

    <footer>
        <div class="footer-content container">
            <div class="social-links">
                <a href="#" data-platform="wechat"><i class="fab fa-weixin"></i></a>
                <a href="#" data-platform="weibo"><i class="fab fa-weibo"></i></a>
                <a href="#" data-platform="twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" data-platform="instagram"><i class="fab fa-instagram"></i></a>
            </div>
            <div class="copyright">
                © 2023 唐诗三百首策略游戏 | 保留所有权利
            </div>
            <div class="author-info">
                作者：朱永池 | 联系邮箱：<a href="mailto:5278566337@qq.com">5278566337@qq.com</a>
            </div>
        </div>
    </footer>

    <!-- 诗词数据文件 -->
    <script src="poems.js"></script>
    <script src="poems2.js"></script>
    <script src="poems3.js"></script>
    <script src="poems4.js"></script>
    <script src="poems5.js"></script>
    <script src="poems6.js"></script>
    <script src="poems7.js"></script>
    <script src="poems8.js"></script>
    <script src="poems9.js"></script>
    <script src="poems10.js"></script>

    <script>
        // 合并所有诗词数据
        const questions = [...poems, ...poems2, ...poems3, ...poems4, ...poems5, ...poems6, ...poems7, ...poems8, ...poems9, ...poems10];
        
        let currentQuestionIndex = 0;
        let selectedAnswers = [];

        // 用于翻译的对象
        const translations = {
            zh: {
                title: "唐诗三百首历史策略游戏",
                subtitle: "探索古代诗词，体验历史变迁",
                welcome: "欢迎来到唐诗世界",
                intro: "在这个游戏中，您将通过做出不同的历史选择，探索中国古典诗词的魅力。每一个选择都将引领您走向不同的历史道路，解锁不同的诗词。请开始您的诗词之旅吧！",
                startJourney: "开始您的旅程",
                readPoem: "朗读诗词",
                nextQuestion: "下一题",
                restart: "重新开始",
                copyright: "© 2023 唐诗三百首策略游戏 保留所有权利",
                author: "作者：朱永池",
                contact: "联系邮箱：",
                logo: "唐诗三百首",
                poemTitle: "篇章标题：",
                background: "历史背景：",
                characters: "关键人物：",
                gameEnd: "游戏结束，你已完成所有题目！"
            },
            en: {
                title: "Tang Poetry Strategy Game",
                subtitle: "Explore Ancient Poetry, Experience Historical Changes",
                welcome: "Welcome to the World of Tang Poetry",
                intro: "In this game, you will explore the charm of classical Chinese poetry by making different historical choices. Each choice will lead you to a different historical path and unlock different poems. Start your poetry journey now!",
                startJourney: "Begin Your Journey",
                readPoem: "Read Poem",
                nextQuestion: "Next Question",
                restart: "Restart",
                copyright: "© 2023 Tang Poetry Strategy Game. All Rights Reserved",
                author: "Author: Zhu Yongchi",
                contact: "Email: ",
                logo: "300 Tang Poems",
                poemTitle: "Title: ",
                background: "Background: ",
                characters: "Characters: ",
                gameEnd: "Game Over! You have completed all questions!"
            }
        };

        // 初始化显示第一个问题
        document.addEventListener('DOMContentLoaded', function() {
            initLanguageSwitcher();
            detectUserRegion();
            loadPlayerChoices();
            
            // 检查浏览器是否支持Web Speech API
            if (!window.speechSynthesis) {
                console.warn("This browser doesn't support the Web Speech API");
                document.querySelector('.read-button').style.opacity = "0.5";
                document.querySelector('.read-button').title = "Your browser doesn't support reading feature";
            }
        });
        
        // 开始游戏的函数
        function startGame() {
            // 隐藏开始按钮
            document.getElementById('start-button').style.display = 'none';
            // 显示问题容器
            document.getElementById('question-container').style.display = 'block';
            // 显示第一个问题
            showQuestion();
        }

        // 自动检测用户地区并设置语言
        function detectUserRegion() {
            // 首先尝试使用navigator.language获取浏览器语言
            const browserLang = navigator.language || navigator.userLanguage;
            
            // 尝试使用IP地理位置API检测地区
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    const country = data.country_code;
                    // 如果是中国地区(CN)，设置为中文
                    if (country === 'CN') {
                        setLanguage('zh');
                    } else {
                        // 如果不是中国地区，设置为英文
                        setLanguage('en');
                    }
                })
                .catch(error => {
                    // 如果API调用失败，退回到使用浏览器语言判断
                    console.error('无法获取地区信息，使用浏览器语言作为备选:', error);
                    if (browserLang && browserLang.startsWith('zh')) {
                        setLanguage('zh');
                    } else {
                        setLanguage('en');
                    }
                });
        }

        // 设置语言并更新UI
        function setLanguage(lang) {
            // 更新语言选择器的值
            const languageSelect = document.getElementById('languageSelect');
            languageSelect.value = lang;
            
            // 更新页面上的文本
            updateLanguage(lang);
            
            // 保存语言选择到localStorage
            localStorage.setItem('preferredLanguage', lang);
        }

        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const questionContainer = document.getElementById('question-container');
            const lang = document.getElementById('languageSelect').value;
            
            if (lang === 'zh') {
                questionContainer.innerHTML = `
                    <p><strong>${translations[lang].poemTitle}</strong>《${question.title}》</p>
                    <p><strong>${translations[lang].background}</strong>${question.background}</p>
                    <p><strong>${translations[lang].characters}</strong>${question.characters}</p>
                    <p><strong>${question.question}</strong></p>
                `;
            } else {
                // 英文模式下显示翻译后的问题和选项
                questionContainer.innerHTML = `
                    <p><strong>${translations[lang].poemTitle}</strong>${question.title}</p>
                    <p><strong>${translations[lang].background}</strong>${getEnglishText(question.background)}</p>
                    <p><strong>${translations[lang].characters}</strong>${getEnglishText(question.characters)}</p>
                    <p><strong>${getEnglishText(question.question)}</strong></p>
                `;
            }
            
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option';
                
                // 根据语言决定按钮文本
                if (lang === 'zh') {
                    button.textContent = option.label;
                } else {
                    // 英文模式下翻译选项
                    button.textContent = getEnglishOption(option.label);
                }
                
                button.onclick = () => chooseOption(option.value);
                questionContainer.appendChild(button);
            });
        }
        
        // 获取英文选项翻译
        function getEnglishOption(chineseOption) {
            // 提取选项字母和内容
            const optionParts = chineseOption.split('.');
            const optionLetter = optionParts[0].trim();
            const optionContent = optionParts[1].trim();
            
            // 返回翻译后的选项
            return `${optionLetter}. ${getEnglishText(optionContent)}`;
        }
        
        // 获取英文文本（模拟翻译）
        function getEnglishText(chineseText) {
            // 中英文对照表
            const translationMap = {
                // 背景描述翻译
                "贞观之治时期，大唐盛世": "During the Zhenguan Era, the golden age of Tang Dynasty",
                "唐朝边境战事频繁，将士戍边卫国": "Frequent border conflicts during Tang Dynasty, with soldiers guarding the frontiers",
                "唐朝社会稳定，文人喜爱寄情田园": "Stable Tang society where scholars enjoyed pastoral life",
                "唐朝文人的离别与相思": "Parting and longing among Tang Dynasty scholars",
                "唐朝文人的报国之志": "The patriotic aspirations of Tang Dynasty scholars",
                "李白在月下独自饮酒，感慨万千": "Li Bai drinking alone under the moon, filled with emotions",
                "孟郊科举及第后的喜悦心情": "Meng Jiao's joy after passing the imperial examination",
                "寒冬腊月，柳宗元独自垂钓于江上": "In cold winter, Liu Zongyuan fishing alone on the river",
                "王维观看到将军狩猎的壮观场面": "Wang Wei watching the magnificent scene of a general hunting",
                "李商隐与爱人离别时的不舍与思念": "Li Shangyin's reluctance and longing when parting with his lover",
                "白居易送别友人，借草表达离别之情": "Bai Juyi bidding farewell to a friend, using grass as a metaphor for parting",
                "孟浩然拜访老友，享受田园之乐": "Meng Haoran visiting an old friend, enjoying pastoral pleasure",
                
                // 人物翻译
                "李白、杜甫、玄宗皇帝": "Li Bai, Du Fu, Emperor Xuanzong",
                "王昌龄、王之涣": "Wang Changling, Wang Zhihuan",
                "王维、孟浩然": "Wang Wei, Meng Haoran",
                "李白、杨贵妃": "Li Bai, Yang Guifei",
                "岑参、高适": "Cen Shen, Gao Shi",
                "李白、明月": "Li Bai, bright moon",
                "孟郊": "Meng Jiao",
                "柳宗元": "Liu Zongyuan",
                "王维、将军": "Wang Wei, general",
                "李商隐、爱人": "Li Shangyin, lover",
                "白居易、友人": "Bai Juyi, friend",
                "孟浩然、老友": "Meng Haoran, old friend",
                "王翰、将士们": "Wang Han, soldiers",
                
                // 问题翻译
                "面对安史之乱，你作为诗人会：": "As a poet facing the An-Shi Rebellion, would you:",
                "若你是边塞诗人，更愿描写：": "As a frontier poet, would you prefer to describe:",
                "在田园生活中，你觉得最能体现闲适的是：": "What do you think best represents leisure in pastoral life:",
                "若你身处离别之苦，会如何排遣：": "If you were suffering from separation, how would you find relief:",
                "若你有报国之志，会选择：": "If you had patriotic aspirations, would you choose:",
                "若你如李白般月下独酌，会：": "If you were drinking alone under the moon like Li Bai, would you:",
                "若你科举中第，会：": "If you passed the imperial examination, would you:",
                "在这冰天雪地中，你会：": "In this snowy landscape, would you:",
                "若你是这位将军，会：": "If you were this general, would you:",
                "若你与爱人离别，会：": "If you were parting with your lover, would you:",
                "送别友人时，你会以何种方式表达不舍：": "When saying goodbye to a friend, how would you express your reluctance:",
                "在老友家，你最想做的是：": "At your old friend's home, what would you most like to do:",
                "在这紧张的边塞氛围中，你会：": "In this tense frontier atmosphere, would you:",
                
                // 选项翻译
                "留在长安继续创作": "Stay in Chang'an to continue writing",
                "远走他乡避祸": "Leave to avoid disaster",
                "塞外风光的壮美与孤寂": "The beauty and solitude of the frontier landscape",
                "战争胜利的喜悦与豪情": "The joy and passion of victory in war",
                "清晨耕种劳作": "Work in the fields in the morning",
                "傍晚溪边垂钓": "Fish by the stream in the evening",
                "借酒消愁": "Drown sorrows in wine",
                "写诗寄情": "Express feelings through poetry",
                "投身军旅": "Join the military",
                "以文报国": "Serve the country through literature",
                "沉醉于美酒之中": "Indulge in fine wine",
                "对着明月吟诗": "Recite poetry to the moon",
                "宴请亲朋好友": "Host a feast for friends and family",
                "游历大好河山": "Travel and enjoy the beautiful landscapes",
                "赶紧回家取暖": "Hurry home to warm up",
                "继续享受这宁静": "Continue to enjoy the tranquility",
                "继续狩猎更多猎物": "Continue hunting for more prey",
                "收兵回营": "Return to camp with the troops",
                "默默流泪，不舍离去": "Silently weep, reluctant to leave",
                "约定早日相见": "Promise to meet again soon",
                "折柳相送": "Send off with willow branches",
                "吟诗赠别": "Recite poems as farewell gifts",
                "与老友畅聊农事": "Chat with old friend about farming",
                "欣赏田园风光": "Appreciate the pastoral scenery",
                "与将士们一同畅饮": "Drink together with the soldiers",
                "坚守岗位，准备战斗": "Stay at your post, prepare for battle",
                
                // 结果翻译
                "留守长安将亲历历史变革，可能创作出更多反映时代的诗篇": 
                    "Staying in Chang'an will allow you to witness historical changes and create poems that reflect the times.",
                "避祸他乡可保全性命，但可能错过重要的创作素材": 
                    "Avoiding trouble by leaving may save your life, but you might miss important creative material.",
                "你能以独特视角展现边塞的神秘与苍凉，引发人们对边疆的遐想": 
                    "You can reveal the mystery and desolation of the frontier from a unique perspective, inspiring people's imagination about the borderlands.",
                "你的诗作可鼓舞士气，增强人们对国家的信心": 
                    "Your poems can boost morale and strengthen people's confidence in the country.",
                "体验劳作的充实，更能感悟田园生活的质朴": 
                    "Experience the fulfillment of labor and better appreciate the simplicity of pastoral life.",
                "享受静谧时光，让心灵在自然中得到放松": 
                    "Enjoy the quiet time and let your mind relax in nature.",
                "短暂的沉醉可忘却烦恼，但醒来后可能更添忧愁": 
                    "A brief indulgence can help forget troubles, but may add more sorrow after sobering up.",
                "将情感寄托于文字，或许能得到些许慰藉": 
                    "Entrusting emotions to writing may bring some comfort.",
                "在战场上挥洒热血，为国家立下战功": 
                    "Shed blood on the battlefield and achieve military merit for the country.",
                "用文字激励人心，为国家凝聚力量": 
                    "Inspire people with words and unite strength for the nation.",
                "忘却一切烦恼，沉浸在酒的世界里": 
                    "Forget all troubles and immerse yourself in the world of wine.",
                "用诗歌抒发内心的情感，与明月相伴": 
                    "Express inner feelings through poetry, with the bright moon as company.",
                "与亲朋好友分享喜悦，共度欢乐时光": 
                    "Share joy with family and friends, spending happy times together.",
                "欣赏祖国的壮丽山河，开阔眼界": 
                    "Appreciate the magnificent landscapes of the country and broaden your horizons.",
                "寒冷难耐，回家寻求温暖": 
                    "The cold is unbearable, go home to seek warmth.",
                "沉浸在这宁静的氛围中，感受大自然的宁静之美": 
                    "Immerse yourself in this peaceful atmosphere and feel the quiet beauty of nature.",
                "享受狩猎的乐趣，追求更多的收获": 
                    "Enjoy the pleasure of hunting and pursue more rewards.",
                "适可而止，回营休整": 
                    "Know when to stop and return to camp for rest.",
                "沉浸在离别的悲伤中，难以释怀": 
                    "Immersed in the sadness of parting, difficult to let go.",
                "给彼此一个期待，期待早日重逢": 
                    "Give each other something to look forward to, hoping for an early reunion.",
                "折柳寓意着挽留，希望友人留下": 
                    "The willow branches symbolize retention, hoping the friend will stay.",
                "用诗歌表达内心的不舍与祝福": 
                    "Express inner reluctance and blessings through poetry.",
                "了解农事，感受乡村的生活气息": 
                    "Learn about farming and experience the atmosphere of rural life.",
                "欣赏美丽的田园风光，放松心情": 
                    "Appreciate the beautiful pastoral scenery and relax your mood.",
                "与将士们同甘共苦，增强士气": 
                    "Share joy and sorrow with the soldiers, boosting morale.",
                "时刻准备应对敌人的进攻，保卫边疆": 
                    "Always be ready to respond to enemy attacks and defend the frontier.",
                
                // 默认回退处理
                "default": "Translation not available"
            };
            
            return translationMap[chineseText] || chineseText; // 如果没有翻译，返回原文
        }

        function chooseOption(option) {
            const question = questions[currentQuestionIndex];
            const resultText = document.getElementById('result-text');
            const resultContainer = document.getElementById('result-container');
            const questionContainer = document.getElementById('question-container');
            const poemTitle = document.getElementById('poem-title');
            const poemAuthor = document.getElementById('poem-author');
            const lang = document.getElementById('languageSelect').value;
            
            // 记录玩家的选择
            savePlayerChoice(question.title, option);

            // 根据语言显示结果
            if (lang === 'zh') {
                resultText.textContent = question.results[option];
            } else {
                // 英文模式下翻译结果
                resultText.textContent = getEnglishText(question.results[option]);
            }
            
            poemTitle.textContent = question.poem.title;
            poemAuthor.textContent = question.poem.author;

            resultContainer.style.display = 'block';
            questionContainer.style.display = 'none';

            // 展示诗词卡片
            const poem = question.poem;
            let poemSvg;
            
            if (lang === 'zh') {
                // 中文模式下只显示原诗
                poemSvg = `
<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg"> 
  <!-- 卡片背景 -->
  <rect width="800" height="600" fill="#F7E9D9"/>
  
  <!-- 古风纹样装饰 -->
  <path d="M20 20 H780 V580 H20 Z" fill="none" stroke="#8B4513" stroke-width="2"/>
  <path d="M40 40 H760 V560 H40 Z" fill="none" stroke="#8B4513" stroke-width="1"/>
  
  <!-- 标题区域 -->
  <text x="400" y="100" font-family="KaiTi, SimSun, serif" font-size="32" text-anchor="middle" fill="#8B4513">
    ${poem.title}
  </text>
  
  <!-- 作者署名 -->
  <text x="400" y="150" font-family="KaiTi, SimSun, serif" font-size="24" text-anchor="middle" fill="#8B4513">
    ${poem.author}
  </text>
  
  <!-- 诗词内容 -->
  <text x="400" y="250" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[0]}
  </text>
  <text x="400" y="300" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[1]}
  </text>
  <text x="400" y="350" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[2]}
  </text>
  <text x="400" y="400" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[3]}
  </text>
  
  <!-- 装饰元素 -->
  <path d="M100 500 Q150 450 200 500 T300 500" fill="none" stroke="#8B4513" stroke-width="1"/>
  <path d="M500 500 Q550 450 600 500 T700 500" fill="none" stroke="#8B4513" stroke-width="1"/>
</svg>
                `;
            } else {
                // 英文模式下增加英文翻译
                poemSvg = `
<svg viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg"> 
  <!-- 卡片背景 -->
  <rect width="800" height="800" fill="#F7E9D9"/>
  
  <!-- 古风纹样装饰 -->
  <path d="M20 20 H780 V780 H20 Z" fill="none" stroke="#8B4513" stroke-width="2"/>
  <path d="M40 40 H760 V760 H40 Z" fill="none" stroke="#8B4513" stroke-width="1"/>
  
  <!-- 标题区域 -->
  <text x="400" y="80" font-family="KaiTi, SimSun, serif" font-size="32" text-anchor="middle" fill="#8B4513">
    ${poem.title}
  </text>
  
  <!-- 作者署名 -->
  <text x="400" y="120" font-family="KaiTi, SimSun, serif" font-size="24" text-anchor="middle" fill="#8B4513">
    ${poem.author}
  </text>
  
  <!-- 诗词内容 -->
  <text x="400" y="200" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[0]}
  </text>
  <text x="400" y="250" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[1]}
  </text>
  <text x="400" y="300" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[2]}
  </text>
  <text x="400" y="350" font-family="KaiTi, SimSun, serif" font-size="28" text-anchor="middle" fill="#8B4513">
    ${poem.content[3]}
  </text>
  
  <!-- 英文翻译 -->
  <text x="400" y="430" font-family="Times New Roman, serif" font-size="18" text-anchor="middle" fill="#8B4513" font-style="italic">
    Translation:
  </text>
  <text x="400" y="470" font-family="Times New Roman, serif" font-size="16" text-anchor="middle" fill="#8B4513">
    ${getPoemTranslation(poem.title, 0)}
  </text>
  <text x="400" y="500" font-family="Times New Roman, serif" font-size="16" text-anchor="middle" fill="#8B4513">
    ${getPoemTranslation(poem.title, 1)}
  </text>
  <text x="400" y="530" font-family="Times New Roman, serif" font-size="16" text-anchor="middle" fill="#8B4513">
    ${getPoemTranslation(poem.title, 2)}
  </text>
  <text x="400" y="560" font-family="Times New Roman, serif" font-size="16" text-anchor="middle" fill="#8B4513">
    ${getPoemTranslation(poem.title, 3)}
  </text>
  
  <!-- 装饰元素 -->
  <path d="M100 680 Q150 630 200 680 T300 680" fill="none" stroke="#8B4513" stroke-width="1"/>
  <path d="M500 680 Q550 630 600 680 T700 680" fill="none" stroke="#8B4513" stroke-width="1"/>
</svg>
                `;
            }
            document.getElementById('poem-container').innerHTML = poemSvg;
        }

        // 获取诗歌的英文翻译
        function getPoemTranslation(poemTitle, lineIndex) {
            // 为每首诗提供默认翻译
            const translationMap = {
                "送杜少府之任蜀州": [
                    "City walls guard the three Qin regions",
                    "Through mist I gaze toward the five rivers",
                    "We share the same feelings of parting",
                    "Both of us travelers in official service"
                ],
                "出塞二首·其一": [
                    "The moon that shone on Qin now shines on Han pass",
                    "Those who marched thousands of miles have not returned",
                    "If only the Flying General were still here",
                    "Barbarian horses would never cross Yin Mountain"
                ],
                "山居秋暝": [
                    "Empty mountains after fresh rain",
                    "As evening brings autumn air",
                    "Bright moon shines through pine trees",
                    "Clear springs flow over stones"
                ],
                "相思": [
                    "Red beans grow in southern lands",
                    "In spring how many branches sprout",
                    "I wish you would gather more",
                    "This plant best represents longing"
                ],
                "白雪歌送武判官归京": [
                    "North wind sweeps the land, white grass bends",
                    "In Hu territory, snow flies in August",
                    "As if spring wind arrived overnight",
                    "Thousand trees bloom like pear blossoms"
                ],
                "月下独酌四首·其一": [
                    "Among flowers with a jug of wine",
                    "I drink alone with no companion",
                    "Raising my cup to invite the moon",
                    "With my shadow, we become three"
                ],
                "登科后": [
                    "In the past my humble state was nothing to boast of",
                    "Today my untamed thoughts know no bounds",
                    "Spring breeze carries me on swift horse hooves",
                    "In one day I see all the flowers of Chang'an"
                ],
                "江雪": [
                    "On a thousand hills, birds have vanished",
                    "On ten thousand paths, human traces are gone",
                    "In a lonely boat, an old man in straw cape and hat",
                    "Fishes alone in the cold river snow"
                ],
                "观猎": [
                    "Strong winds make the bow strings sing",
                    "The general hunts by Wei city",
                    "In dry grass, the hawk's eye is keen",
                    "On thinning snow, the horse's hooves are light"
                ],
                "无题·相见时难别亦难": [
                    "Meeting is hard, parting is also hard",
                    "The east wind lacks strength as flowers wither",
                    "Spring silkworms weave until death",
                    "Wax candles become ash only when tears dry"
                ],
                "赋得古原草送别": [
                    "Spreading across the ancient plain, grass",
                    "Each year withers and flourishes anew",
                    "Prairie fires cannot burn it all",
                    "Spring winds make it grow again"
                ],
                "过故人庄": [
                    "My old friend prepares chicken and millet",
                    "Invites me to his country home",
                    "Green trees join around the village",
                    "Blue mountains rise beyond the town"
                ],
                // 为更多诗歌添加翻译...
                // 默认翻译，用于没有专门定义的诗
                "default": [
                    "This ancient poem describes natural beauty",
                    "And expresses the poet's deep emotions",
                    "Reflecting on life's profound meanings",
                    "Through elegant classical Chinese verse"
                ]
            };
            
            // 返回对应诗歌的翻译，如果没有则返回默认翻译
            return translationMap[poemTitle] ? translationMap[poemTitle][lineIndex] : translationMap["default"][lineIndex];
        }

        // 朗读诗词函数
        function readPoem() {
            // 检查浏览器是否支持Web Speech API
            if (!window.speechSynthesis) {
                const lang = document.getElementById('languageSelect').value;
                if (lang === 'zh') {
                    alert("您的浏览器不支持朗读功能，请尝试使用Chrome、Edge或Safari浏览器。");
                } else {
                    alert("Your browser doesn't support the reading feature. Please try using Chrome, Edge, or Safari.");
                }
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const poem = question.poem;
            const poemText = poem.content.join('，');

            const synth = window.speechSynthesis;
            const utterThis = new SpeechSynthesisUtterance(poemText);
            utterThis.lang = 'zh-CN';

            synth.speak(utterThis);
        }

        // 游戏进度保存
        let playerChoices = [];
        
        function savePlayerChoice(questionTitle, choice) {
            playerChoices.push({
                question: questionTitle,
                choice: choice,
                timestamp: new Date().toISOString()
            });
            
            // 保存到localStorage
            localStorage.setItem('playerChoices', JSON.stringify(playerChoices));
        }
        
        function loadPlayerChoices() {
            const savedChoices = localStorage.getItem('playerChoices');
            if (savedChoices) {
                playerChoices = JSON.parse(savedChoices);
            }
        }
        
        // 显示游戏总结
        function showGameSummary(isEndGame = false) {
            const lang = document.getElementById('languageSelect').value;
            let summaryText = '';
            
            if (lang === 'zh') {
                summaryText = `您的游戏${isEndGame ? '结束' : ''}总结：\n\n`;
                if (playerChoices.length === 0) {
                    summaryText += '您还没有做出任何选择。';
                } else {
                    summaryText += `您共做出了${playerChoices.length}个选择：\n\n`;
                    playerChoices.forEach((choice, index) => {
                        summaryText += `${index+1}. 在"${choice.question}"中，您选择了选项 ${choice.choice}\n`;
                    });
                    summaryText += '\n感谢您体验唐诗三百首策略游戏！';
                }
            } else {
                summaryText = `Your Game ${isEndGame ? 'Final ' : ''}Summary:\n\n`;
                if (playerChoices.length === 0) {
                    summaryText += 'You haven\'t made any choices yet.';
                } else {
                    summaryText += `You've made a total of ${playerChoices.length} choices:\n\n`;
                    playerChoices.forEach((choice, index) => {
                        summaryText += `${index+1}. In "${choice.question}", you chose option ${choice.choice}\n`;
                    });
                    summaryText += '\nThank you for experiencing the Tang Poetry Strategy Game!';
                }
            }
            
            alert(summaryText);
        }

        function showNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                const resultContainer = document.getElementById('result-container');
                const questionContainer = document.getElementById('question-container');
                resultContainer.style.display = 'none';
                questionContainer.style.display = 'block';
                showQuestion();
            } else {
                const lang = document.getElementById('languageSelect').value;
                alert(translations[lang].gameEnd);
                // 显示游戏总结（游戏结束状态）
                showGameSummary(true);
                restartGame(false); // 不再显示总结
            }
        }

        function restartGame(showSummary = true) {
            currentQuestionIndex = 0;
            
            // 只有在明确要求时才显示游戏总结
            if (showSummary) {
                showGameSummary();
            }
            
            // 重置玩家选择记录
            playerChoices = [];
            localStorage.setItem('playerChoices', JSON.stringify(playerChoices));
            
            // 显示开始按钮，隐藏其他容器
            document.getElementById('start-button').style.display = 'inline-block';
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('result-container').style.display = 'none';
            document.getElementById('poem-container').innerHTML = '';
        }

        function initLanguageSwitcher() {
            const languageSelect = document.getElementById('languageSelect');
            
            // 检查localStorage中是否有保存的语言选择
            const savedLanguage = localStorage.getItem('preferredLanguage');
            if (savedLanguage) {
                languageSelect.value = savedLanguage;
                updateLanguage(savedLanguage);
            }
            
            languageSelect.addEventListener('change', function() {
                const lang = this.value;
                updateLanguage(lang);
                // 保存用户的语言选择
                localStorage.setItem('preferredLanguage', lang);
            });
        }

        function updateLanguage(lang) {
            document.title = translations[lang].title;
            document.querySelector('h1').textContent = translations[lang].title;
            document.querySelector('.subtitle').textContent = translations[lang].subtitle;
            document.querySelector('.intro h2').textContent = translations[lang].welcome;
            document.querySelector('.intro p').textContent = translations[lang].intro;
            
            // 更新开始按钮文本
            const startButton = document.getElementById('start-button');
            if (startButton) {
                startButton.innerHTML = `<i class="fas fa-play"></i> ${translations[lang].startJourney}`;
            }
            
            document.querySelector('.read-button').innerHTML = `<i class="fas fa-volume-up"></i> ${translations[lang].readPoem}`;
            document.querySelector('.next-button').innerHTML = `<i class="fas fa-arrow-right"></i> ${translations[lang].nextQuestion}`;
            document.querySelector('.restart-button').innerHTML = `<i class="fas fa-redo"></i> ${translations[lang].restart}`;
            
            document.querySelector('.copyright').textContent = translations[lang].copyright;
            
            // 更新作者信息区域的文本
            const authorInfoElement = document.querySelector('.author-info');
            if (lang === 'zh') {
                authorInfoElement.innerHTML = `${translations[lang].author} | ${translations[lang].contact}<a href="mailto:527856337@qq.com">527856337@qq.com</a>`;
            } else {
                authorInfoElement.innerHTML = `${translations[lang].author} | ${translations[lang].contact}<a href="mailto:527856337@qq.com">527856337@qq.com</a>`;
            }
            
            // 更新logo文本
            const logoElement = document.querySelector('.logo');
            if (lang === 'zh') {
                logoElement.innerHTML = `<i class="fas fa-book-open"></i> ${translations[lang].logo}`;
            } else {
                logoElement.innerHTML = `<i class="fas fa-book-open"></i> ${translations[lang].logo}`;
            }
            
            // 刷新当前问题
            if (document.getElementById('question-container').style.display !== 'none') {
                showQuestion();
            } else {
                // 如果当前是在显示结果页面，需要更新一些文本元素
                const resultContainer = document.getElementById('result-container');
                if (resultContainer.style.display === 'block') {
                    // 更新标题标签
                    const poemInfoElement = document.querySelector('.poem-info');
                    if (lang === 'zh') {
                        // 无需修改，因为默认就是中文
                    } else {
                        // 在英文模式下，需要添加一些英文提示
                        const poemTitleLabel = document.querySelector('.poem-info');
                        poemTitleLabel.style.fontStyle = 'italic';
                    }
                }
            }
        }

        // 页面关闭前显示游戏总结
        window.addEventListener('beforeunload', function(e) {
            // 显示提示信息
            if (playerChoices.length > 0) {
                const message = '您即将离开游戏，要查看游戏总结吗？';
                e.returnValue = message;
                return message;
            }
        });

        // 社交媒体分享功能
        function shareToSocial(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('唐诗三百首历史策略游戏 - 我的诗词性格测试');
            const summaryText = playerChoices.length > 0 ? generateSummary() : '来测测你的诗词性格倾向吧！';
            const summary = encodeURIComponent(summaryText);
            
            let shareUrl = '';
            
            switch(platform) {
                case 'wechat':
                    // 微信需要通过特殊处理，这里弹出二维码或提示
                    alert('请截屏后，打开微信扫一扫分享。或复制链接分享到微信。');
                    break;
                case 'weibo':
                    shareUrl = `https://service.weibo.com/share/share.php?url=${url}&title=${title}&pic=&searchPic=false`;
                    window.open(shareUrl, '_blank', 'width=700,height=500');
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
                    window.open(shareUrl, '_blank', 'width=700,height=500');
                    break;
                case 'instagram':
                    // Instagram不支持直接分享链接，提示用户截图分享
                    alert('请截屏您的结果，然后在Instagram上分享图片。');
                    break;
            }
        }

        // 生成分享摘要
        function generateSummary() {
            let summary = "我的诗词性格测试结果：";
            const lastResult = document.querySelector('.result').textContent;
            if (lastResult) {
                summary += lastResult;
            } else {
                summary += "测试显示我是一个充满诗意的人！";
            }
            return summary;
        }

        // 显示分享对话框
        function showShareDialog() {
            // 如果已有对话框则移除
            const existingDialog = document.getElementById('shareDialog');
            if (existingDialog) {
                existingDialog.remove();
            }
            
            const dialog = document.createElement('div');
            dialog.id = 'shareDialog';
            dialog.style.position = 'fixed';
            dialog.style.top = '50%';
            dialog.style.left = '50%';
            dialog.style.transform = 'translate(-50%, -50%)';
            dialog.style.backgroundColor = '#fff';
            dialog.style.padding = '20px';
            dialog.style.borderRadius = '10px';
            dialog.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.2)';
            dialog.style.zIndex = '1000';
            dialog.style.maxWidth = '90%';
            dialog.style.width = '400px';
            
            dialog.innerHTML = `
                <h3 style="color: #8B4513; margin-top: 0;">分享测试结果</h3>
                <p>${generateSummary()}</p>
                <div style="display: flex; justify-content: space-around; margin: 20px 0;">
                    <button onclick="shareToSocial('wechat')" style="background-color: #7BB32E; border: none; color: white; padding: 10px; border-radius: 5px; cursor: pointer;"><i class="fab fa-weixin"></i> 微信</button>
                    <button onclick="shareToSocial('weibo')" style="background-color: #E6162D; border: none; color: white; padding: 10px; border-radius: 5px; cursor: pointer;"><i class="fab fa-weibo"></i> 微博</button>
                    <button onclick="shareToSocial('twitter')" style="background-color: #1DA1F2; border: none; color: white; padding: 10px; border-radius: 5px; cursor: pointer;"><i class="fab fa-twitter"></i> Twitter</button>
                    <button onclick="shareToSocial('instagram')" style="background-color: #C13584; border: none; color: white; padding: 10px; border-radius: 5px; cursor: pointer;"><i class="fab fa-instagram"></i> Instagram</button>
                </div>
                <button onclick="document.getElementById('shareDialog').remove()" style="background-color: #8B4513; border: none; color: white; padding: 10px; border-radius: 5px; cursor: pointer; width: 100%;">关闭</button>
            `;
            
            document.body.appendChild(dialog);
            
            // 添加半透明遮罩
            const overlay = document.createElement('div');
            overlay.id = 'dialogOverlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            overlay.style.zIndex = '999';
            overlay.onclick = function() {
                document.getElementById('shareDialog').remove();
                this.remove();
            };
            
            document.body.insertBefore(overlay, dialog);
        }

        // 为社交媒体图标添加点击事件
        document.addEventListener('DOMContentLoaded', function() {
            // 在footer中找到社交媒体图标并添加事件
            const socialIcons = document.querySelectorAll('.social-links a');
            socialIcons.forEach(icon => {
                icon.addEventListener('click', function(e) {
                    e.preventDefault();
                    const platform = this.getAttribute('data-platform');
                    if (platform) {
                        shareToSocial(platform);
                    } else {
                        showShareDialog();
                    }
                });
            });
            
            // 添加游戏结束时显示分享对话框
            if (typeof showGameSummary === 'function') {
                const originalShowGameSummary = showGameSummary;
                window.showGameSummary = function() {
                    originalShowGameSummary();
                    // 在总结显示后添加分享按钮
                    const summaryContainer = document.querySelector('.summary-container');
                    if (summaryContainer) {
                        const shareButton = document.createElement('button');
                        shareButton.innerText = '分享结果';
                        shareButton.className = 'restart-button';
                        shareButton.style.marginTop = '20px';
                        shareButton.onclick = showShareDialog;
                        summaryContainer.appendChild(shareButton);
                    }
                };
            }
            
            // 监听重启游戏按钮点击事件
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('restart-button')) {
                    // 在重启游戏前弹出分享对话框
                    const shouldRestart = confirm('是否要分享您的测试结果？点击"确定"进行分享，点击"取消"直接重新开始游戏。');
                    if (shouldRestart) {
                        showShareDialog();
                        e.preventDefault(); // 阻止立即重启
                        return false;
                    }
                }
            }, true);
        });
    </script>
</body>
</html> 